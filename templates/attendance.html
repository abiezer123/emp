<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Attendance Management</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <header>
        <nav class="navbar">
            <div class="nav-left">
                <div class="navbar-brand">Empire Church</div>
            </div>

            <!-- Burger icon toggle -->
            <input type="checkbox" id="nav-toggle" class="nav-toggle" />
            <label for="nav-toggle" class="nav-toggle-label">
                <span></span>
                <span></span>
                <span></span>
            </label>

            <!-- Navigation links -->
            <ul class="navbar-links">
                <li><a href="/attendance" class="{{ 'active' if request.path == '/attendance' else '' }}">Home</a>
                </li>
                <li><a href="/members" class="{{ 'active' if request.path == '/members' else '' }}">Members</a></li>
                <li><a href="/logout">Logout</a></li>
            </ul>
        </nav>


    </header>


    <main>

        <div class="partition">
            <h2>Attendance</h2>
            <br>
            <form id="attendance-form" autocomplete="off">
                <div class="suggestions-container">
                    <input type="text" id="name" placeholder="Enter name" required />
                    <ul id="suggestions" class="suggestions-list hidden"></ul>

                    <label for="visitor"></label>Visitor</label>
                    <label class="switch">
                        <input type="checkbox" id="visitor" name="is_visitor" value="visitor">
                        <span class="slider round"></span>
                    </label>
                </div>

                <input type="datetime-local" id="date" required />
                <button type="submit">Submit</button>
            </form>
        </div>

        <div class="partition">
            <h3 style="text-align: center; font-size: 28px; margin-bottom: 10px;" id="dateForHeading"></h3>
            <br>
            <div style="display: flex; align-items: center; gap: 50px;">
                <input type="date" id="filter-date" />
                <button type="button" style="background-color: #27ae60;;" onclick="openBulkEditModal()">Edit</button>
            </div>

            <!-- Modal for edit date -->
            <div id="bulkEditModal" class="edit-modal-overlay hidden">
                <div class="edit-modal-content">
                    <button class="edit-modal-close" onclick="closeBulkModal()">×</button>
                    <h2>Edit attendance</h2>

                    <label>Change all records from:</label>

                    <input type="date" id="from-date" />

                    <hr>
                    <label>Change them to:</label>
                    <input type="datetime-local" id="to-date" />

                    <div class="edit-modal-buttons">
                        <button onclick="submitBulkEdit()">Save Changes</button>
                    </div>
                </div>
            </div>


            <table id="attendance-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Date &amp; Time</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>

        </div>

        <div class="partition">
            <br>
            <div class="dashboard-controls">
                <label for="timeframe">View by:</label>
                <select id="timeframe" onchange="updateUI()">
                    <option value="monthly" selected>Monthly</option>
                    <option value="yearly" selected>Yearly</option>
                </select>
                <label id="dateLabel" for="dateSelect">Select Month:</label>
                <input type="month" id="dateSelect" />
            </div>

            <h2 class="dashboard-heading">Dashboard</h2>
            <div class="dashboard-scroll">
                <canvas id="attendanceChart" style="max-width: 900px; margin-top: 2rem;"></canvas>
            </div>

        </div>

        <div class="partition">
            <h3>Attendance Summary</h3>
            <table id="summaryTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Attendance Count</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="partition">

            <div id="top-attendees-section" style="position: relative; width: 100%; max-width: 1500px; margin: 0 auto;">
                <h3 style="text-align: center; font-size: 28px; color: #e91e63; margin-bottom: 10px;">
                    ⭐ Top Attendees ⭐
                </h3>

                <!-- Cute Celebration GIF -->
                <img src="https://gifsec.com/wp-content/uploads/2022/10/celebrate-gif-13.gif" alt="Congrats GIF"
                    style="width: 220px; display: block; margin: 10px auto;" />

                <!-- Confetti Canvas (hidden from layout, positioned absolutely inside the div) -->
                <canvas id="confetti-canvas"
                    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></canvas>

                <!-- Table -->
                <table id="rankingTable">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Name</th>
                            <th>Attendance Count</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data rows will go here -->
                    </tbody>
                </table>
            </div>
        </div>


        <div class="partition">
            <div>
                <label for="download-month">Select Month:</label>
                <input type="month" id="download-month" />
                <button id="download-btn">Download Attendance</button>

            </div>
        </div>
    </main>

    <div id="delete-confirmation" class="modal hidden">
        <div class="modal-content">
            <p>Are you sure you want to delete this entry?</p>
            <button id="confirm-delete">Yes</button>
            <button id="cancel-delete">No</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>