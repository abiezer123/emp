<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Attendance Management</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <header>
        <nav class="navbar">
            <div class="navbar-brand">
                Empire Church
            </div>

            <!-- Burger icon (mobile only) -->
            <input type="checkbox" id="nav-toggle" class="nav-toggle" />
            <label for="nav-toggle" class="nav-toggle-label">
                <span></span>
                <span></span>
                <span></span>
            </label>

            <!-- Navigation links -->
            <ul class="navbar-links">
                <li>
                    <a href="/attendance" class="{{ 'active' if request.path == '/attendance' else '' }}">
                        <span class="material-icons">home</span> Home
                    </a>
                </li>
                <li>
                    <a href="/members" class="{{ 'active' if request.path == '/members' else '' }}">
                        <span class="material-icons">groups</span> Members
                    </a>
                </li>
                <li>
                    <a href="/birthdays" class="{{ 'active' if request.path == '/birthdays' else '' }}">
                        <span class="material-icons">cake</span> Birthdays
                    </a>
                </li>
                <li>
                    <a href="/logout">
                        <span class="material-icons">logout</span> Logout
                    </a>
                </li>
            </ul>
        </nav>
    </header>


    <main>
        <!-- LEFT COLUMN -->
        <div class="left-column">
            <!-- Attendance Form -->
            <div class="partition" id="attendance_partition">
                <h2 style="text-align: center;">Attendance</h2>
                <br>
                <form id="attendance-form" autocomplete="off">
                    <div class="suggestions-container">
                        <input type="text" id="name" placeholder="Enter name" required />
                        <ul id="suggestions" class="suggestions-list hidden"></ul>
                        <br>

                        <label for="online">Online</label>
                        <label class="switch">
                            <input type="checkbox" id="online" name="is_online" value="online">
                            <span class="slider round"></span>
                        </label>

                        <label for="visitor">Visitor</label>
                        <label class="switch">
                            <input type="checkbox" id="visitor" name="is_visitor" value="visitor">
                            <span class="slider round"></span>
                        </label>
                        <br>

                        <label for="children">Children</label>
                        <label class="switch">
                            <input type="checkbox" id="children" name="is_child" value="children">
                            <span class="slider round"></span>
                        </label>



                    </div>

                    <input type="datetime-local" id="date" required />
                    <button type="submit">Submit</button>
                </form>
            </div>

            <!-- Attendance Summary -->
            <div class="partition" id="attendance-summary-partition">
                <h3 style="text-align: center;">Attendance Summary</h3>
                <table id="summaryTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Attendance Count</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- Top Attendees -->
            <div class="partition" id="top-attendees-partition">
                <div id="top-attendees-section">
                    <h3 style="text-align: center; font-size: 28px; color: #7e0b0b;">⭐ Top Attendees ⭐</h3>
                    <img src="https://gifsec.com/wp-content/uploads/2022/10/celebrate-gif-13.gif" alt="Congrats GIF"
                        style="width: 220px; display: block; margin: 10px auto;" />
                    <canvas id="confetti-canvas"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></canvas>
                    <table id="rankingTable">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Name</th>
                                <th>Attendance Count</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN -->
        <div class="right-column">
            <!-- Attendance Table -->
            <div class="partition" id="partition-attendance-table">
                <h3 id="dateForHeading" style="text-align: center; font-size: 28px;"></h3>
                <div style="display: flex; align-items: center; gap: 50px;">
                    <input type="date" id="filter-date" />
                    <button type="button" id="table-edit-button"
                        style="background-color: #27ae60; border: none; padding: 6px 10px; border-radius: 5px; cursor: pointer;"
                        onclick="openBulkEditModal()">
                        <span class="material-icons" style="color: white; vertical-align: middle;">edit</span>
                    </button>
                </div>

                <!-- Modal -->
                <div id="bulkEditModal" class="edit-modal-overlay hidden">
                    <div class="edit-modal-content">
                        <button class="edit-modal-close" onclick="closeBulkModal()">×</button>
                        <h2>Edit attendance</h2>
                        <label>Change all records from:</label>
                        <input type="date" id="from-date" />
                        <hr>
                        <label>Change them to:</label>
                        <input type="datetime-local" id="to-date" />
                        <div class="edit-modal-buttons">
                            <button onclick="submitBulkEdit()">Save Changes</button>
                        </div>
                    </div>
                </div>

                <table id="attendance-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Label</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>


            <!-- Dashboard Controls -->
            <div class="partition" id="dashboard-controls-partition">
                <div class="dashboard-controls">
                    <label for="timeframe">View by:</label>
                    <select id="timeframe" onchange="updateUI()">
                        <option value="monthly">Monthly</option>
                        <option value="yearly" selected>Yearly</option>
                    </select>
                    <br><br>
                    <label id="dateLabel" for="dateSelect">Select Month:</label>
                    <input type="month" id="dateSelect" />
                </div>

                <h2 class="dashboard-heading">Dashboard</h2>
                <div class="dashboard-scroll">
                    <canvas id="attendanceChart" style="max-width: 900px; margin-top: 2rem;"></canvas>
                </div>
            </div>

            <!-- Download -->
            <div class="partition" id="download-partition">
                <label for="download-month">Select Month:</label>
                <input type="month" id="download-month" />
                <button id="download-btn">Download Attendance</button>
            </div>
        </div>
    </main>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirmation" class="modal hidden">
        <div class="modal-content">
            <p>Are you sure you want to delete this entry?</p>
            <button id="confirm-delete">Yes</button>
            <button id="cancel-delete">No</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>

<div id="delete-confirmation" class="modal hidden">
    <div class="modal-content">
        <p>Are you sure you want to delete this entry?</p>
        <button id="confirm-delete">Yes</button>
        <button id="cancel-delete">No</button>
    </div>
</div>

<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>